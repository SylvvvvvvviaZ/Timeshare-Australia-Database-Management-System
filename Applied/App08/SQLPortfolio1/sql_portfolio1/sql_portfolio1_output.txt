SQL> 
SQL> --****PLEASE ENTER YOUR DETAILS BELOW****
SQL> --sql_portfolio1.sql
SQL> 
SQL> --Student ID:33049246
SQL> --Student Name:XiaowenZhou
SQL> --Unit Code:FIT2094
SQL> --Applied Class No: Applied 01, Melbourne Wed 18:00
SQL> 
SQL> --set echo on
SQL> --spool week7_schema_output.txt
SQL> 
SQL> /*Task 1: CREATE table POLICY and non FK constraints*/
SQL> 
SQL> CREATE TABLE policy (
  2      policy_id        NUMBER(7) NOT NULL,
  3      prop_no          NUMBER(4) NOT NULL,
  4      policy_startdate DATE NOT NULL,
  5      policy_type_code CHAR(1) NOT NULL,
  6      policy_length    NUMBER(3) NOT NULL CHECK (policy_length >= 6),
  7      insurer_code     CHAR(3) NOT NULL
  8  );

Table POLICY created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_id IS
  2      'Policy unique identifier';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.prop_no IS
  2      'Property unique identifier';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_startdate IS
  2      'Policy start date';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_type_code IS
  2      'Policy type code';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_length IS
  2      'Length of policy in months (minimum 6 months)';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.insurer_code IS
  2      'Insurance company code';

Comment created.

SQL> 
SQL> /*Task 1: Add FK constraints*/
SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_pk PRIMARY KEY ( policy_id );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_no_uq UNIQUE (prop_no);

Table POLICY altered.

SQL> ALTER TABLE policy ADD CONSTRAINT policy_startdate_uq UNIQUE (policy_startdate);

Table POLICY altered.

SQL> ALTER TABLE policy ADD CONSTRAINT policy_type_code_uq UNIQUE (policy_type_code);

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT property_policy 
  2      FOREIGN KEY (prop_no) REFERENCES property(prop_no);

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT property_type_policy 
  2      FOREIGN KEY (policy_type_code) REFERENCES policy_type(policy_type_code);

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT insurer_policy 
  2      FOREIGN KEY (insurer_code) REFERENCES insurer(insurer_code);

Table POLICY altered.

SQL> 
SQL> /*Task 2*/
SQL> 
SQL> --The policy_type_code 'B' indicates that this is a building insurance policy.       
SQL> --The insurer_code 'LW' indicates that this is  Ludovika Wiggins as an insurance company.
SQL> DECLARE
  2    v_policy_id_1 NUMBER;
  3    v_policy_id_2 NUMBER;
  4  
  5  BEGIN
  6      SELECT policy_id_seq.NEXTVAL INTO v_policy_id_1 FROM DUAL;
  7      SELECT policy_id_seq.NEXTVAL INTO v_policy_id_2 FROM DUAL;
  8  
  9  INSERT INTO policy (
 10      policy_id,
 11      prop_no,
 12      policy_startdate,
 13      policy_type_code,
 14      policy_length,
 15      insurer_code
 16  ) VALUES (
 17      v_policy_id_1,
 18      7145,
 19      TO_DATE('21-APR-2023', 'DD-MON-YYYY'),
 20      'B',
 21      12,
 22      'LW'
 23  );
 24  
 25  INSERT INTO policy (
 26      policy_id,
 27      prop_no,
 28      policy_startdate,
 29      policy_type_code,
 30      policy_length,
 31      insurer_code
 32  ) VALUES (
 33      v_policy_id_2,
 34      9346,
 35      TO_DATE('21-APR-2023', 'DD-MON-YYYY'),
 36      'B',
 37      12,
 38      'LW'
 39  );
 40  
 41  
 42  /*Task 3*/
 43  
 44  -- Update the policy record for property number 7145
 45  
 46  UPDATE policy SET policy_length = 18 WHERE prop_no = 7145;
 47  
 48  -- Insert a new policy record
 49  INSERT
 50      INTO policy (
 51          policy_id,
 52          prop_no,
 53          policy_startdate,
 54          policy_type_code,
 55          policy_length,
 56          insurer_code
 57      )
 58  VALUES (3,
 59             7145,
 60             '01-MAY-23',
 61             'B',
 62             12,
 63             'LW');
 64  
 65  COMMIT;
 66  
 67  
 68  /*Task 4*/
 69  
 70  DELETE FROM policy
 71  WHERE
 72          prop_no = 7145
 73      AND policy_startdate = DATE '2023-05-02'
 74      AND policy_type_code = 'B'
 75      AND policy_length = 6
 76      AND insurer_code = 'LW';
 77  
 78  DELETE FROM policy
 79  WHERE
 80          prop_no = 7145
 81      AND policy_startdate = DATE '2023-05-02'
 82      AND policy_type_code = 'B'
 83      AND policy_length = 12
 84      AND insurer_code = 'LW';
 85  
 86  COMMIT;
 87  
 88  
 89  
 90  --Comment out SET ECHO and SPOOL commands before submitting your portfolio
 91  SPOOL OFF
 92  SET ECHO OFF

Error starting at line : 66 in command -
DECLARE
  v_policy_id_1 NUMBER;
  v_policy_id_2 NUMBER;

BEGIN
    SELECT policy_id_seq.NEXTVAL INTO v_policy_id_1 FROM DUAL;
    SELECT policy_id_seq.NEXTVAL INTO v_policy_id_2 FROM DUAL;

INSERT INTO policy (
    policy_id,
    prop_no,
    policy_startdate,
    policy_type_code,
    policy_length,
    insurer_code
) VALUES (
    v_policy_id_1,
    7145,
    TO_DATE('21-APR-2023', 'DD-MON-YYYY'),
    'B',
    12,
    'LW'
);

INSERT INTO policy (
    policy_id,
    prop_no,
    policy_startdate,
    policy_type_code,
    policy_length,
    insurer_code
) VALUES (
    v_policy_id_2,
    9346,
    TO_DATE('21-APR-2023', 'DD-MON-YYYY'),
    'B',
    12,
    'LW'
);


/*Task 3*/

-- Update the policy record for property number 7145

UPDATE policy SET policy_length = 18 WHERE prop_no = 7145;

-- Insert a new policy record
INSERT
    INTO policy (
        policy_id,
        prop_no,
        policy_startdate,
        policy_type_code,
        policy_length,
        insurer_code
    )
VALUES (3,
           7145,
           '01-MAY-23',
           'B',
           12,
           'LW');

COMMIT;


/*Task 4*/

DELETE FROM policy
WHERE
        prop_no = 7145
    AND policy_startdate = DATE '2023-05-02'
    AND policy_type_code = 'B'
    AND policy_length = 6
    AND insurer_code = 'LW';

DELETE FROM policy
WHERE
        prop_no = 7145
    AND policy_startdate = DATE '2023-05-02'
    AND policy_type_code = 'B'
    AND policy_length = 12
    AND insurer_code = 'LW';

COMMIT;



--Comment out SET ECHO and SPOOL commands before submitting your portfolio
SPOOL OFF
SET ECHO OFF
Error report -
ORA-06550: line 91, column 7:
PLS-00103: Encountered the symbol "OFF" when expecting one of the following:

   := . ( @ % ;
06550. 00000 -  "line %s, column %s:\n%s"
*Cause:    Usually a PL/SQL compilation error.
*Action:
