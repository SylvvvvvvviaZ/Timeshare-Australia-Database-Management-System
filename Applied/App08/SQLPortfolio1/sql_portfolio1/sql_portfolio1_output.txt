SQL> 
SQL> --****PLEASE ENTER YOUR DETAILS BELOW****
SQL> --sql_portfolio1.sql
SQL> 
SQL> --Student ID:33049246
SQL> --Student Name:XiaowenZhou
SQL> --Unit Code:FIT2094
SQL> --Applied Class No: Applied 01, Melbourne Wed 18:00
SQL> 
SQL> --set echo on
SQL> --spool week7_schema_output.txt
SQL> 
SQL> /*Task 1: CREATE table POLICY and non FK constraints*/
SQL> 
SQL> CREATE TABLE policy (
  2      policy_id        NUMBER(7) NOT NULL,
  3      prop_no          NUMBER(4) NOT NULL,
  4      policy_startdate DATE NOT NULL,
  5      policy_type_code CHAR(1) NOT NULL,
  6      policy_length    NUMBER(3) NOT NULL,
  7      insurer_code     CHAR(3) NOT NULL
  8  );

Table POLICY created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_id IS
  2      'Policy unique identifier';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.prop_no IS
  2      'Property unique identifier';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_startdate IS
  2      'Policy start date';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_type_code IS
  2      'Policy type code';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.policy_length IS
  2      'Length of policy in months (minimum 6 months)';

Comment created.

SQL> 
SQL> COMMENT ON COLUMN policy.insurer_code IS
  2      'Insurance company code';

Comment created.

SQL> 
SQL> /*Task 1: Add FK constraints*/
SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_pk PRIMARY KEY ( policy_id );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_no_uq UNIQUE ( prop_no );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy
  2      ADD CONSTRAINT property_policy FOREIGN KEY (prop_no)
  3          REFERENCES policy(prop_no);

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_startdate_uq UNIQUE ( policy_startdate );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy ADD CONSTRAINT policy_type_code_uq UNIQUE ( policy_type_code );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy
  2      ADD CONSTRAINT property_type_policy FOREIGN KEY ( policy_type_code )
  3          REFERENCES policy( policy_type_code );

Table POLICY altered.

SQL> 
SQL> ALTER TABLE policy
  2      ADD CONSTRAINT insurer_policy FOREIGN KEY ( insurer_code )
  3          REFERENCES policy ( insurer_code );

Error starting at line : 63 in command -
ALTER TABLE policy
    ADD CONSTRAINT insurer_policy FOREIGN KEY ( insurer_code )
        REFERENCES policy ( insurer_code )
Error report -
ORA-02270: no matching unique or primary key for this column-list
02270. 00000 -  "no matching unique or primary key for this column-list"
*Cause:    A REFERENCES clause in a CREATE/ALTER TABLE statement
           gives a column-list for which there is no matching unique or primary
           key constraint in the referenced table.
*Action:   Find the correct column names using the ALL_CONS_COLUMNS
           catalog view
SQL> 
SQL> 
SQL> 
SQL> /*Task 2*/
SQL> 
SQL> --The policy_type_code 'B' indicates that this is a building insurance policy.       
SQL> --The insurer_code 'LW' indicates that this is  Ludovika Wiggins as an insurance company.
SQL> 
SQL>     INSERT INTO policy (
  2          policy_id,
  3          prop_no,
  4          policy_startdate,
  5          policy_type_code,
  6          policy_length,
  7          insurer_code
  8      ) VALUES (
  9          1,
 10          7145,
 11           '21-APR-23',
 12          'B',
 13          12,
 14          'LW'
 15      );

1 row inserted.

SQL> INSERT INTO policy (
  2      policy_id,
  3      prop_no,
  4      policy_startdate,
  5      policy_type_code,
  6      policy_length,
  7      insurer_code
  8  ) VALUES (
  9      2,
 10      9346,
 11      '21-APR-23',
 12      'B',
 13      12,
 14      'LW'
 15  );

Error starting at line : 89 in command -
INSERT INTO policy (
    policy_id,
    prop_no,
    policy_startdate,
    policy_type_code,
    policy_length,
    insurer_code
) VALUES (
    2,
    9346,
    '21-APR-23',
    'B',
    12,
    'LW'
)
Error report -
ORA-00001: unique constraint (XZHO0118.POLICY_STARTDATE_UQ) violated

SQL> 
SQL> /*Task 3*/
SQL> 
SQL> -- Update the policy record for property number 7145
SQL> 
SQL> UPDATE policy SET policy_length = 18 WHERE prop_no = 7145;

1 row updated.

SQL> 
SQL> -- Insert a new policy record
SQL> INSERT
  2      INTO policy (
  3          policy_id,
  4          prop_no,
  5          policy_startdate,
  6          policy_type_code,
  7          policy_length,
  8          insurer_code
  9      )
 10  VALUES (3,
 11             7145,
 12             '01-MAY-23',
 13             'B',
 14             12,
 15             'LW');

Error starting at line : 112 in command -
INSERT
    INTO policy (
        policy_id,
        prop_no,
        policy_startdate,
        policy_type_code,
        policy_length,
        insurer_code
    )
VALUES (3,
           7145,
           '01-MAY-23',
           'B',
           12,
           'LW')
Error report -
ORA-00001: unique constraint (XZHO0118.POLICY_NO_UQ) violated

SQL> 
SQL> COMMIT;

Commit complete.

SQL> 
SQL> 
SQL> /*Task 4*/
SQL> 
SQL> DELETE FROM policy
  2  WHERE
  3          prop_no = 7145
  4      AND policy_startdate = DATE '2023-05-02'
  5      AND policy_type_code = 'B'
  6      AND policy_length = 6
  7      AND insurer_code = 'LW';

0 rows deleted.

SQL> 
SQL> DELETE FROM policy
  2  WHERE
  3          prop_no = 7145
  4      AND policy_startdate = DATE '2023-05-02'
  5      AND policy_type_code = 'B'
  6      AND policy_length = 12
  7      AND insurer_code = 'LW';

0 rows deleted.

SQL> 
SQL> COMMIT;

Commit complete.

SQL> 
SQL> 
SQL> 
SQL> --Comment out SET ECHO and SPOOL commands before submitting your portfolio
SQL> SPOOL OFF
